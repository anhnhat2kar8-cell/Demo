--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LP = Players.LocalPlayer
local Char = LP.Character or LP.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart")

LP.CharacterAdded:Connect(function(c)
    Char = c
    HRP = c:WaitForChild("HumanoidRootPart")
end)

--// SETTINGS
local Farm = true
local HeightAboveHead = 4 -- độ cao đứng trên đầu
local AttackDelay = 0.1

--// NOCLIP
RunService.Stepped:Connect(function()
    for _,v in pairs(Char:GetDescendants()) do
        if v:IsA("BasePart") then
            v.CanCollide = false
        end
    end
end)

--// FIND NPC
local function getNPC()
    local nearest, dist
    for _,v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model")
        and v:FindFirstChild("Humanoid")
        and v:FindFirstChild("HumanoidRootPart")
        and v.Humanoid.Health > 0
        and not Players:GetPlayerFromCharacter(v) then

            local d = (v.HumanoidRootPart.Position - HRP.Position).Magnitude
            if not dist or d < dist then
                dist = d
                nearest = v
            end
        end
    end
    return nearest
end

--// FARM LOOP (ĐỨNG TRÊN ĐẦU)
task.spawn(function()
    while task.wait(AttackDelay) do
        if Farm and Char and HRP then
            local npc = getNPC()
            if npc and npc:FindFirstChild("HumanoidRootPart") then

                local headPos =
                    npc.HumanoidRootPart.Position
                    + Vector3.new(0, HeightAboveHead, 0)

                -- Đứng trên đầu & quay mặt xuống
                HRP.CFrame = CFrame.new(
                    headPos,
                    npc.HumanoidRootPart.Position
                )

                -- Đánh
                local tool = Char:FindFirstChildOfClass("Tool")
                if tool then
                    pcall(function()
                        tool:Activate()
                    end)
                end
            end
        end
    end
end)
