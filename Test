local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local lp = Players.LocalPlayer
local guiParent = lp:WaitForChild("PlayerGui")

-- === Character refs ===
local function getCharacter()
    return lp.Character or lp.CharacterAdded:Wait()
end
local chr = getCharacter()
local hum = chr:WaitForChild("Humanoid")
local hrp = chr:WaitForChild("HumanoidRootPart")

-- === Config ===
local farming = false
local autoAttack = true
local autoLoot = true
local autoHeal = true
local healThreshold = 50 -- % mÃ¡u
local wpSpeed = 0.15 -- tá»‘c Ä‘á»™ tween giá»¯a waypoint
local reachDistance = 2 -- khoáº£ng cÃ¡ch Ä‘á»ƒ coi lÃ  tá»›i waypoint
local radius = 22 -- bÃ¡n kÃ­nh quanh boss
local height = 6 -- Ä‘á»™ cao waypoint

-- Danh sÃ¡ch waypoint quanh boss (offset so vá»›i boss)
local waypoints = {
    Vector3.new(radius, height, 0),
    Vector3.new(0, height + 2, radius),
    Vector3.new(-radius, height, 0),
    Vector3.new(0, height - 3, -radius)
}
local currentWP = 1

-- === GUI ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZENX_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = guiParent

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 280, 0, 200)
MainFrame.Position = UDim2.new(0.04, 0, 0.25, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
MainFrame.BackgroundTransparency = 0.28
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 36)
Title.Position = UDim2.new(0, 0, 0, 6)
Title.BackgroundTransparency = 1
Title.Text = "ðŸ’€ ZENX ðŸ’€"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Center
Title.Parent = MainFrame

local FarmButton = Instance.new("TextButton")
FarmButton.Size = UDim2.new(1, -24, 0, 40)
FarmButton.Position = UDim2.new(0, 12, 0, 48)
FarmButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
FarmButton.BackgroundTransparency = 0.38
FarmButton.Text = "Báº­t Farm Boss"
FarmButton.Font = Enum.Font.GothamBold
FarmButton.TextSize = 18
FarmButton.TextColor3 = Color3.fromRGB(255,255,255)
FarmButton.Parent = MainFrame
Instance.new("UICorner", FarmButton).CornerRadius = UDim.new(0, 8)

FarmButton.MouseButton1Click:Connect(function()
    farming = not farming
    FarmButton.Text = farming and "Táº¯t Farm Boss" or "Báº­t Farm Boss"
end)

-- === Billboard Boss ===
local billboardGui = Instance.new("BillboardGui")
billboardGui.Name = "BossHealthBar"
billboardGui.Size = UDim2.new(6, 0, 1.2, 0)
billboardGui.AlwaysOnTop = true
billboardGui.ExtentsOffset = Vector3.new(0, 4.5, 0)
billboardGui.Adornee = nil
billboardGui.Parent = Workspace

local bossLabel = Instance.new("TextLabel")
bossLabel.Size = UDim2.new(1, 0, 0.45, 0)
bossLabel.Position = UDim2.new(0, 0, 0, -20)
bossLabel.BackgroundTransparency = 1
bossLabel.Text = "BOSS"
bossLabel.TextColor3 = Color3.fromRGB(220, 30, 30)
bossLabel.Font = Enum.Font.GothamBold
bossLabel.TextScaled = true
bossLabel.Parent = billboardGui
bossLabel.TextStrokeTransparency = 0.6

local bgFrame = Instance.new("Frame")
bgFrame.Size = UDim2.new(0.9, 0, 0.35, 0)
bgFrame.Position = UDim2.new(0.05, 0, 0.5, 0)
bgFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
bgFrame.BackgroundTransparency = 0.15
bgFrame.BorderSizePixel = 0
bgFrame.Parent = billboardGui
Instance.new("UICorner", bgFrame).CornerRadius = UDim.new(0, 8)

local healthBar = Instance.new("Frame")
healthBar.Size = UDim2.new(1, 0, 1, 0)
healthBar.Position = UDim2.new(0, 0, 0, 0)
healthBar.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
healthBar.BorderSizePixel = 0
healthBar.Parent = bgFrame
Instance.new("UICorner", healthBar).CornerRadius = UDim.new(0, 8)

local hpText = Instance.new("TextLabel")
hpText.Size = UDim2.new(1, 0, 0.55, 0)
hpText.Position = UDim2.new(0, 0, 1.05, 0)
hpText.BackgroundTransparency = 1
hpText.TextColor3 = Color3.new(1,1,1)
hpText.Font = Enum.Font.GothamBold
hpText.TextScaled = true
hpText.TextStrokeTransparency = 0.7
hpText.Parent = billboardGui

local pctText = Instance.new("TextLabel")
pctText.Size = UDim2.new(0.25, 0, 0.55, 0)
pctText.Position = UDim2.new(0.735, 0, 1.05, 0)
pctText.BackgroundTransparency = 1
pctText.TextColor3 = Color3.new(1,1,1)
pctText.Font = Enum.Font.GothamBold
pctText.TextScaled = true
pctText.TextStrokeTransparency = 0.7
pctText.Parent = billboardGui

local currentBoss = nil

local function findBoss()
    local chosen = nil
    local myPos = hrp.Position
    local shortest = math.huge
    for _, v in pairs(Workspace:GetDescendants()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") then
            local humv = v:FindFirstChild("Humanoid")
            if humv and humv.Health > 0 and not Players:GetPlayerFromCharacter(v) then
                local d = (v.HumanoidRootPart.Position - myPos).Magnitude
                if d < shortest then
                    chosen = v
                    shortest = d
                end
            end
        end
    end
    return chosen
end

task.spawn(function()
    while task.wait(0.08) do
        chr = getCharacter()
        hum = chr:FindFirstChild("Humanoid") or hum
        hrp = chr:FindFirstChild("HumanoidRootPart") or hrp

        local boss = findBoss()
        if boss then
            currentBoss = boss
            local thrp = boss.HumanoidRootPart
            billboardGui.Adornee = thrp
            billboardGui.Enabled = true

            local bHum = boss:FindFirstChild("Humanoid")
            local cur = math.clamp(bHum.Health, 0, bHum.MaxHealth)
            local pct = cur / bHum.MaxHealth

            if pct > 0.5 then
                healthBar.BackgroundColor3 = Color3.fromRGB(0, 220, 0)
            elseif pct > 0.2 then
                healthBar.BackgroundColor3 = Color3.fromRGB(255, 210, 0)
            else
                healthBar.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
            end

            healthBar:TweenSize(UDim2.new(pct, 0, 1, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.08, true)
            hpText.Text = string.format("%d / %d", math.floor(cur), math.floor(bHum.MaxHealth))
            pctText.Text = string.format("%.0f%%", pct * 100)
        else
            currentBoss = nil
            billboardGui.Enabled = false
        end
    end
end)

-- === Auto heal ===
task.spawn(function()
    while task.wait(0.6) do
        if autoHeal then
            if hum and hum.Health / hum.MaxHealth * 100 <= healThreshold then
                local lastWeapon
                local curTool = lp.Character:FindFirstChildOfClass("Tool")
                if curTool and not curTool.Name:lower():find("bÄƒng") and not curTool.Name:lower():find("bandage") then
                    lastWeapon = curTool
                end
                for _, t in ipairs(lp.Backpack:GetChildren()) do
                    if t:IsA("Tool") and (t.Name:lower():find("bÄƒng") or t.Name:lower():find("bandage")) then
                        t.Parent = lp.Character
                        task.wait(0.12)
                        local healTool = lp.Character:FindFirstChildWhichIsA("Tool")
                        if healTool then
                            healTool:Activate()
                            task.wait(1)
                            if lastWeapon and lastWeapon.Parent == lp.Backpack then
                                lastWeapon.Parent = lp.Character
                            end
                        end
                        break
                    end
                end
            end
        end
    end
end)

-- === Auto loot ===
task.spawn(function()
    while task.wait(0.45) do
        if autoLoot and hrp then
            for _, prompt in pairs(Workspace:GetDescendants()) do
                if prompt:IsA("ProximityPrompt") then
                    local ok, parentPos = pcall(function() return prompt.Parent.Position end)
                    if ok and parentPos and (hrp.Position - parentPos).Magnitude <= 16 then
                        pcall(function() fireproximityprompt(prompt) end)
                        task.wait(0.12)
                    end
                end
            end
        end
    end
end)

-- === Auto attack ===
local function attack()
    local tool = lp.Character and lp.Character:FindFirstChildOfClass("Tool")
    if tool then pcall(function() tool:Activate() end) end
end

-- === Di chuyá»ƒn theo waypoint quanh boss ===
RunService.Heartbeat:Connect(function()
    if farming then
        local target = currentBoss or findBoss()
        if target and target:FindFirstChild("HumanoidRootPart") and target.Humanoid.Health > 0 then
            local thrp = target.HumanoidRootPart
            local goalPos = thrp.Position + waypoints[currentWP]
            if (hrp.Position - goalPos).Magnitude <= reachDistance then
                currentWP = currentWP % #waypoints + 1
            end
            local tween = TweenService:Create(hrp, TweenInfo.new(wpSpeed, Enum.EasingStyle.Linear), {
                CFrame = CFrame.new(goalPos, thrp.Position)
            })
            tween:Play()
            if hum then hum.AutoRotate = false end
            if autoAttack then attack() end
        else
            if hum then hum.AutoRotate = true end
        end
    else
        if hum then hum.AutoRotate = true end
    end
end)

lp.CharacterAdded:Connect(function(char)
    chr = char
    hum = chr:WaitForChild("Humanoid")
    hrp = chr:WaitForChild("HumanoidRootPart")
end)
