local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")

-- Local player + gui parent
local lp = Players.LocalPlayer
local guiParent = lp:WaitForChild("PlayerGui")

-- === Character refs (c·∫≠p nh·∫≠t khi respawn) ===
local function getCharacter()
    return lp.Character or lp.CharacterAdded:Wait()
end

local chr = getCharacter()
local hum = chr:FindFirstChild("Humanoid") or chr:WaitForChild("Humanoid")
local hrp = chr:FindFirstChild("HumanoidRootPart") or chr:WaitForChild("HumanoidRootPart")

-- Update when respawn
lp.CharacterAdded:Connect(function(char)
    chr = char
    hum = chr:WaitForChild("Humanoid")
    hrp = chr:WaitForChild("HumanoidRootPart")
end)

-- === Config bi·∫øn (m·∫∑c ƒë·ªãnh) ===
local farming = false
local radius = 22
local speed = 2
local autoAttack = true
local autoLoot = true
local autoHeal = true
local healThreshold = 50 -- % player ƒë·ªÉ d√πng bƒÉng (50%)

-- === GUI ch√≠nh (lu√¥n hi·ªÉn th·ªã, draggable) ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZENX_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = guiParent

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 320, 0, 260)
MainFrame.Position = UDim2.new(0.02, 0, 0.15, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
MainFrame.BackgroundTransparency = 0.15
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 36)
Title.Position = UDim2.new(0, 0, 0, 6)
Title.BackgroundTransparency = 1
Title.Text = "üíÄ ZENX MENU"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Center
Title.Parent = MainFrame

-- helper: small toggle button creator
local function createToggle(y, text, initial, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -24, 0, 30)
    btn.Position = UDim2.new(0, 12, 0, y)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.BackgroundTransparency = 0.2
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Text = (initial and "B·∫¨T: " or "T·∫ÆT: ") .. text
    btn.Parent = MainFrame
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)
    local state = initial
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.Text = (state and "B·∫¨T: " or "T·∫ÆT: ") .. text
        callback(state)
    end)
    return btn
end

-- Toggles
local autoBtn = createToggle(52, "Auto ƒê√°nh", autoAttack, function(s) autoAttack = s end)
local healBtn = createToggle(92, "Auto BƒÉng G·∫°c", autoHeal, function(s) autoHeal = s end)
local lootBtn = createToggle(132, "Auto L·ª•m", autoLoot, function(s) autoLoot = s end)

-- Farm on/off big button
local FarmButton = Instance.new("TextButton")
FarmButton.Size = UDim2.new(1, -24, 0, 40)
FarmButton.Position = UDim2.new(0, 12, 0, 172)
FarmButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
FarmButton.BackgroundTransparency = 0
FarmButton.Text = "B·∫≠t Farm Boss"
FarmButton.Font = Enum.Font.GothamBold
FarmButton.TextSize = 18
FarmButton.TextColor3 = Color3.fromRGB(255,255,255)
FarmButton.Parent = MainFrame
Instance.new("UICorner", FarmButton).CornerRadius = UDim.new(0, 8)
FarmButton.MouseButton1Click:Connect(function()
    farming = not farming
    FarmButton.Text = farming and "T·∫Øt Farm Boss" or "B·∫≠t Farm Boss"
end)

-- Input helpers (radius, speed, healThreshold)
local function createLabeledInput(y, labelText, initialValue, onChanged)
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(0.45, 0, 0, 28)
    lbl.Position = UDim2.new(0, 12, 0, y)
    lbl.BackgroundTransparency = 1
    lbl.Text = labelText
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 14
    lbl.TextColor3 = Color3.fromRGB(230,230,230)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = MainFrame

    local tb = Instance.new("TextBox")
    tb.Size = UDim2.new(0.45, -12, 0, 28)
    tb.Position = UDim2.new(0.5, 0, 0, y)
    tb.BackgroundColor3 = Color3.fromRGB(50,50,50)
    tb.TextColor3 = Color3.new(1,1,1)
    tb.Text = tostring(initialValue)
    tb.Font = Enum.Font.Gotham
    tb.TextSize = 14
    tb.ClearTextOnFocus = false
    tb.Parent = MainFrame
    Instance.new("UICorner", tb).CornerRadius = UDim.new(0,6)

    tb.FocusLost:Connect(function(enter)
        local n = tonumber(tb.Text)
        if n then
            onChanged(n)
            tb.Text = tostring(n)
        else
            tb.Text = tostring(initialValue)
        end
    end)

    return tb
end

createLabeledInput(220, "Radius v√≤ng (stud):", radius, function(v) radius = v end)
createLabeledInput(220, "T·ªëc ƒë·ªô v√≤ng:", speed, function(v) speed = v end) -- note: overlaps layout slightly; user can reposition GUI if needed
-- The above two share Y to save space; acceptable but can be moved if desired

-- Small status label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -24, 0, 18)
statusLabel.Position = UDim2.new(0, 12, 0, 216)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Tr·∫°ng th√°i: Idle"
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 14
statusLabel.TextColor3 = Color3.fromRGB(200,200,200)
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = MainFrame

-- === BillboardGui g·∫Øn ƒë·∫ßu boss (ri√™ng) ===
local billboardGui = Instance.new("BillboardGui")
billboardGui.Name = "BossHealthBar"
billboardGui.Size = UDim2.new(6, 0, 1.2, 0)
billboardGui.AlwaysOnTop = true
billboardGui.ExtentsOffset = Vector3.new(0, 4.5, 0)
billboardGui.Adornee = nil
billboardGui.Parent = Workspace

local bossLabel = Instance.new("TextLabel")
bossLabel.Size = UDim2.new(1, 0, 0.45, 0)
bossLabel.Position = UDim2.new(0, 0, 0, -20)
bossLabel.BackgroundTransparency = 1
bossLabel.Text = "BOSS"
bossLabel.TextColor3 = Color3.fromRGB(220, 30, 30)
bossLabel.Font = Enum.Font.GothamBold
bossLabel.TextScaled = true
bossLabel.Parent = billboardGui
bossLabel.TextStrokeTransparency = 0.6

local bgFrame = Instance.new("Frame")
bgFrame.Size = UDim2.new(0.9, 0, 0.35, 0)
bgFrame.Position = UDim2.new(0.05, 0, 0.5, 0)
bgFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
bgFrame.BackgroundTransparency = 0.15
bgFrame.BorderSizePixel = 0
bgFrame.Parent = billboardGui
Instance.new("UICorner", bgFrame).CornerRadius = UDim.new(0, 8)

local healthBar = Instance.new("Frame")
healthBar.Size = UDim2.new(1, 0, 1, 0)
healthBar.Position = UDim2.new(0, 0, 0, 0)
healthBar.BackgroundColor3 = Color3.fromRGB(0, 220, 0)
healthBar.BorderSizePixel = 0
healthBar.Parent = bgFrame
Instance.new("UICorner", healthBar).CornerRadius = UDim.new(0, 8)

local hpText = Instance.new("TextLabel")
hpText.Size = UDim2.new(1, 0, 0.55, 0)
hpText.Position = UDim2.new(0, 0, 1.05, 0)
hpText.BackgroundTransparency = 1
hpText.TextColor3 = Color3.new(1,1,1)
hpText.Font = Enum.Font.GothamBold
hpText.TextScaled = true
hpText.TextStrokeTransparency = 0.7
hpText.Parent = billboardGui

-- === Helper: t√¨m boss g·∫ßn nh·∫•t tr√™n to√†n Workspace ===
local function findNearestBoss()
    local nearest, nearestDist = nil, math.huge
    local myPos = (hrp and hrp.Position) or (chr.PrimaryPart and chr.PrimaryPart.Position) or Vector3.new()
    for _, model in pairs(Workspace:GetDescendants()) do
        if model:IsA("Model") and model:FindFirstChild("Humanoid") and model:FindFirstChild("HumanoidRootPart") then
            -- exclude players' characters
            if not Players:GetPlayerFromCharacter(model) then
                local hum = model:FindFirstChild("Humanoid")
                local root = model:FindFirstChild("HumanoidRootPart")
                if hum and root and hum.MaxHealth and hum.MaxHealth > 0 and hum.Health > 0 then
                    local ok, pos = pcall(function() return root.Position end)
                    if ok and pos then
                        local d = (pos - myPos).Magnitude
                        if d < nearestDist then
                            nearest = model
                            nearestDist = d
                        end
                    end
                end
            end
        end
    end
    return nearest
end

-- === C·∫≠p nh·∫≠t Billboard theo boss g·∫ßn nh·∫•t (lu√¥n hi·ªÉn th·ªã n·∫øu boss t·ªìn t·∫°i) ===
local currentBoss = nil
task.spawn(function()
    while task.wait(0.08) do
        -- refresh character refs (in case)
        chr = getCharacter()
        hum = chr:FindFirstChild("Humanoid") or hum
        hrp = chr:FindFirstChild("HumanoidRootPart") or hrp

        local boss = findNearestBoss()
        if boss and boss:FindFirstChild("HumanoidRootPart") then
            currentBoss = boss
            billboardGui.Adornee = boss.HumanoidRootPart
            billboardGui.Enabled = true

            local bHum = boss:FindFirstChild("Humanoid")
            local cur = math.clamp((bHum and bHum.Health) or 0, 0, (bHum and bHum.MaxHealth) or 1)
            local max = (bHum and bHum.MaxHealth) or 1
            local pct = (max > 0) and (cur / max) or 0

            -- m√†u thanh theo % (xanh >50, v√†ng 20-50, ƒë·ªè <20)
            if pct > 0.5 then
                healthBar.BackgroundColor3 = Color3.fromRGB(0, 220, 0)
            elseif pct > 0.2 then
                healthBar.BackgroundColor3 = Color3.fromRGB(255, 210, 0)
            else
                healthBar.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
            end

            -- Tween thanh
            pcall(function()
                healthBar:TweenSize(UDim2.new(pct, 0, 1, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.08, true)
            end)

            -- Hi·ªÉn th·ªã "HP / Max (xx%)"
            hpText.Text = string.format("%d / %d  (%.0f%%)", math.floor(cur), math.floor(max), pct * 100)
        else
            currentBoss = nil
            billboardGui.Adornee = nil
            billboardGui.Enabled = false
        end
    end
end)

-- === Auto Heal: d√πng tool t√™n ch·ª©a "bƒÉng" ho·∫∑c "bandage" khi HP% <= healThreshold ===
task.spawn(function()
    while task.wait(0.6) do
        if autoHeal and hum and hum.Health and hum.MaxHealth and hum.MaxHealth > 0 then
            local curPct = hum.Health / hum.MaxHealth * 100
            if curPct <= healThreshold then
                -- l∆∞u l·∫°i v≈© kh√≠ ƒëang c·∫ßm (n·∫øu c√≥ v√† kh√¥ng ph·∫£i bandage)
                local lastWeapon = nil
                if lp.Character then
                    local tool = lp.Character:FindFirstChildOfClass("Tool")
                    if tool and not (tool.Name:lower():find("bƒÉng") or tool.Name:lower():find("bandage")) then
                        lastWeapon = tool
                    end
                end

                -- t√¨m bandage trong Backpack
                for _, t in ipairs(lp.Backpack:GetChildren()) do
                    if t:IsA("Tool") and (t.Name:lower():find("bƒÉng") or t.Name:lower():find("bandage")) then
                        -- equip
                        pcall(function() t.Parent = lp.Character end)
                        task.wait(0.12)
                        local healTool = lp.Character and lp.Character:FindFirstChildWhichIsA("Tool")
                        if healTool and (healTool.Name:lower():find("bƒÉng") or healTool.Name:lower():find("bandage")) then
                            pcall(function() healTool:Activate() end)
                            task.wait(1)
                        end
                        break
                    end
                end

                -- tr·∫£ l·∫°i v≈© kh√≠ c≈© n·∫øu c·∫ßn
                if lastWeapon and lastWeapon.Parent == lp.Backpack then
                    pcall(function() lastWeapon.Parent = lp.Character end)
                end
            end
        end
    end
end)

-- === Auto Loot: fire ProximityPrompt g·∫ßn player ===
task.spawn(function()
    while task.wait(0.45) do
        if autoLoot and hrp then
            for _, prompt in pairs(Workspace:GetDescendants()) do
                if prompt:IsA("ProximityPrompt") then
                    local ok, parentPos = pcall(function()
                        return (prompt.Parent and prompt.Parent.Position) or Vector3.new(9e9,9e9,9e9)
                    end)
                    if ok and parentPos and (hrp.Position - parentPos).Magnitude <= 16 then
                        pcall(function() fireproximityprompt(prompt) end)
                        task.wait(0.12)
                    end
                end
            end
        end
    end
end)

-- === Auto Attack: k√≠ch ho·∫°t tool hi·ªán t·∫°i ===
local function attack()
    local tool = lp.Character and lp.Character:FindFirstChildOfClass("Tool")
    if tool then
        pcall(function() tool:Activate() end)
    end
end

-- === Di chuy·ªÉn v√≤ng quanh boss khi farming ===
RunService.Heartbeat:Connect(function()
    if farming then
        -- ∆∞u ti√™n boss hi·ªán t·∫°i n·∫øu c√≥, n·∫øu kh√¥ng th√¨ t√¨m boss
        local target = currentBoss or findNearestBoss()
        if target and target:FindFirstChild("Humanoid") and target:FindFirstChild("HumanoidRootPart") and target.Humanoid.Health > 0 then
            local thrp = target.HumanoidRootPart
            local angle = tick() * (tonumber(speed) or 2)
            local off = Vector3.new(math.cos(angle) * (tonumber(radius) or 22), 0, math.sin(angle) * (tonumber(radius) or 22))
            local goalPos = thrp.Position + off
            local ok, tween = pcall(function()
                return TweenService:Create(hrp, TweenInfo.new(0.12, Enum.EasingStyle.Linear), {CFrame = CFrame.new(goalPos, thrp.Position)})
            end)
            if ok and tween then
                tween:Play()
            else
                pcall(function() hrp.CFrame = CFrame.new(goalPos, thrp.Position) end)
            end
            if hum then pcall(function() hum.AutoRotate = false end) end
            if autoAttack then attack() end
            statusLabel.Text = "Tr·∫°ng th√°i: Farming"
        else
            if hum then pcall(function() hum.AutoRotate = true end) end
            statusLabel.Text = "Tr·∫°ng th√°i: No target"
        end
    else
        if hum then pcall(function() hum.AutoRotate = true end) end
        statusLabel.Text = "Tr·∫°ng th√°i: Idle"
    end
end)

-- === Cleanup khi r·ªùi (t√πy ch·ªçn) ===
game:BindToClose(function()
    if billboardGui and billboardGui.Parent then billboardGui:Destroy() end
    if ScreenGui and ScreenGui.Parent then ScreenGui:Destroy() end
end)

-- End of script
