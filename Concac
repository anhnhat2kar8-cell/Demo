local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local lp = Players.LocalPlayer
local guiParent = lp:WaitForChild("PlayerGui")

-- === Character refs ===
local function getCharacter()
    return lp.Character or lp.CharacterAdded:Wait()
end

local chr = getCharacter()
local hum = chr:WaitForChild("Humanoid")
local hrp = chr:WaitForChild("HumanoidRootPart")

-- === Config ===
local farming = false
local radius = 22
local speed = 2
local autoAttack = true
local currentBoss = nil

-- === GUI ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZENX_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = guiParent

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 280, 0, 150)
MainFrame.Position = UDim2.new(0.04, 0, 0.25, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
MainFrame.BackgroundTransparency = 0.28
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 36)
Title.Position = UDim2.new(0, 0, 0, 6)
Title.BackgroundTransparency = 1
Title.Text = "ðŸ’€ ZENX ðŸ’€"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Center
Title.Parent = MainFrame

local FarmButton = Instance.new("TextButton")
FarmButton.Size = UDim2.new(1, -24, 0, 40)
FarmButton.Position = UDim2.new(0, 12, 0, 48)
FarmButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
FarmButton.BackgroundTransparency = 0.38
FarmButton.Text = "Báº­t Farm Boss"
FarmButton.Font = Enum.Font.GothamBold
FarmButton.TextSize = 18
FarmButton.TextColor3 = Color3.fromRGB(255,255,255)
FarmButton.Parent = MainFrame
Instance.new("UICorner", FarmButton).CornerRadius = UDim.new(0, 8)

local function createEditableLabel(yPos, labelText, getValue, setValue)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -24, 0, 34)
    btn.Position = UDim2.new(0, 12, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btn.BackgroundTransparency = 0.38
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 16
    btn.TextColor3 = Color3.fromRGB(245, 245, 245)
    btn.TextXAlignment = Enum.TextXAlignment.Center
    btn.Text = labelText .. " (vd: " .. tostring(getValue()) .. ")"
    btn.Parent = MainFrame
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

    btn.MouseButton1Click:Connect(function()
        local tb = Instance.new("TextBox")
        tb.Size = btn.Size
        tb.Position = btn.Position
        tb.BackgroundColor3 = btn.BackgroundColor3
        tb.BackgroundTransparency = btn.BackgroundTransparency
        tb.Font = btn.Font
        tb.TextSize = btn.TextSize
        tb.TextColor3 = btn.TextColor3
        tb.ClearTextOnFocus = false
        tb.TextXAlignment = Enum.TextXAlignment.Center
        tb.Text = tostring(getValue())
        tb.Parent = MainFrame
        Instance.new("UICorner", tb).CornerRadius = UDim.new(0, 8)
        tb:CaptureFocus()
        tb.FocusLost:Connect(function()
            local num = tonumber(tb.Text)
            if num then setValue(num) end
            btn.Text = labelText .. " (vd: " .. tostring(getValue()) .. ")"
            tb:Destroy()
        end)
    end)
end

createEditableLabel(96, "Khoáº£ng cÃ¡ch", function() return radius end, function(v) radius = v end)
createEditableLabel(136, "Tá»‘c Ä‘á»™ vÃ²ng", function() return speed end, function(v) speed = v end)

FarmButton.MouseButton1Click:Connect(function()
    farming = not farming
    FarmButton.Text = farming and "Táº¯t Farm Boss" or "Báº­t Farm Boss"
end)

-- === Boss Finder ===
local function findBoss()
    local chosen = nil
    local myPos = hrp.Position
    local shortest = math.huge
    for _, v in pairs(Workspace:GetDescendants()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") then
            local humv = v:FindFirstChild("Humanoid")
            if humv and humv.Health > 0 then
                local owner = Players:GetPlayerFromCharacter(v)
                if not owner then
                    local d = (v.HumanoidRootPart.Position - myPos).Magnitude
                    if d < shortest then
                        chosen = v
                        shortest = d
                    end
                end
            end
        end
    end
    return chosen
end

-- === Auto Attack ===
local function attack()
    local tool = lp.Character and lp.Character:FindFirstChildOfClass("Tool")
    if tool then
        pcall(function() tool:Activate() end)
    end
end

-- === Farm vÃ²ng quanh Boss ===
RunService.Heartbeat:Connect(function()
    if farming then
        local target = currentBoss or findBoss()
        if target and target:FindFirstChild("HumanoidRootPart") and target.Humanoid.Health > 0 then
            local thrp = target.HumanoidRootPart
            local angle = tick() * speed
            local off = Vector3.new(math.cos(angle) * radius, 0, math.sin(angle) * radius)
            local goalPos = thrp.Position + off
            local ok, tween = pcall(function()
                return TweenService:Create(hrp, TweenInfo.new(0.12, Enum.EasingStyle.Linear), {CFrame = CFrame.new(goalPos, thrp.Position)})
            end)
            if ok and tween then
                tween:Play()
            else
                hrp.CFrame = CFrame.new(goalPos, thrp.Position)
            end
            hum.AutoRotate = false
            if autoAttack then attack() end
        else
            hum.AutoRotate = true
        end
    else
        hum.AutoRotate = true
    end
end)

-- === Respawn Handler ===
lp.CharacterAdded:Connect(function(char)
    chr = char
    hum = chr:WaitForChild("Humanoid")
    hrp = chr:WaitForChild("HumanoidRootPart")
end)
