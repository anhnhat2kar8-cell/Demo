local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local lp = Players.LocalPlayer
local guiParent = lp:WaitForChild("PlayerGui")

-- === Character refs ===
local function getCharacter()
    return lp.Character or lp.CharacterAdded:Wait()
end
local chr = getCharacter()
local hum = chr:WaitForChild("Humanoid")
local hrp = chr:WaitForChild("HumanoidRootPart")

-- === Config toggle ===
local farming = false
local autoAttack = true
local autoHeal = false
local autoLoot = false

local radius = 25   -- bÃ¡n kÃ­nh bay quanh boss
local height = 10   -- Ä‘á»™ cao bay quanh boss

-- === GUI ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZENX_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = guiParent

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 280, 0, 250)
MainFrame.Position = UDim2.new(0.05, 0, 0.25, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
MainFrame.BackgroundTransparency = 0.28
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 36)
Title.Position = UDim2.new(0, 0, 0, 6)
Title.BackgroundTransparency = 1
Title.Text = "ðŸ’€ ZENX FARM MENU ðŸ’€"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Parent = MainFrame

-- Helper táº¡o nÃºt
local function makeButton(yPos, text, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -24, 0, 40)
    btn.Position = UDim2.new(0, 12, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btn.BackgroundTransparency = 0.38
    btn.Text = text
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Parent = MainFrame
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    btn.MouseButton1Click:Connect(callback)
    return btn
end

local farmBtn = makeButton(50, "Báº­t Farm Boss", function()
    farming = not farming
    farmBtn.Text = farming and "Táº¯t Farm Boss" or "Báº­t Farm Boss"
end)

local healBtn = makeButton(100, "Báº­t Auto Heal", function()
    autoHeal = not autoHeal
    healBtn.Text = autoHeal and "Táº¯t Auto Heal" or "Báº­t Auto Heal"
end)

local lootBtn = makeButton(150, "Báº­t Auto Loot", function()
    autoLoot = not autoLoot
    lootBtn.Text = autoLoot and "Táº¯t Auto Loot" or "Báº­t Auto Loot"
end)

-- === TÃ¬m boss gáº§n nháº¥t ===
local function findBoss()
    local chosen, shortest = nil, math.huge
    local myPos = hrp.Position
    for _, v in pairs(Workspace:GetDescendants()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") then
            local humv = v:FindFirstChild("Humanoid")
            if humv and humv.Health > 0 then
                local owner = Players:GetPlayerFromCharacter(v)
                if not owner then
                    local d = (v.HumanoidRootPart.Position - myPos).Magnitude
                    if d < shortest then
                        chosen = v
                        shortest = d
                    end
                end
            end
        end
    end
    return chosen
end

-- === Auto Attack ===
local function attack()
    local tool = lp.Character and lp.Character:FindFirstChildOfClass("Tool")
    if tool then
        pcall(function() tool:Activate() end)
    end
end

-- === Auto Heal ===
task.spawn(function()
    while task.wait(1) do
        if autoHeal and hum and hum.Health > 0 then
            if hum.Health < hum.MaxHealth * 0.5 then
                local bandage = lp.Backpack:FindFirstChild("Bandage") or (chr and chr:FindFirstChild("Bandage"))
                if bandage then
                    hum:EquipTool(bandage)
                    task.wait(0.2)
                    pcall(function() bandage:Activate() end)
                end
            end
        end
    end
end)

-- === Auto Loot ===
task.spawn(function()
    while task.wait(0.8) do
        if autoLoot and hrp then
            for _, prompt in pairs(Workspace:GetDescendants()) do
                if prompt:IsA("ProximityPrompt") then
                    local ok, pos = pcall(function() return prompt.Parent.Position end)
                    if ok and (hrp.Position - pos).Magnitude <= 15 then
                        pcall(function() fireproximityprompt(prompt) end)
                    end
                end
            end
        end
    end
end)

-- === Bay theo waypoint quanh boss + Ä‘Ã¡nh ===
RunService.Heartbeat:Connect(function()
    if farming and hum and hum.Health > 0 then
        local target = findBoss()
        if target and target:FindFirstChild("HumanoidRootPart") and target.Humanoid.Health > 0 then
            local thrp = target.HumanoidRootPart
            local t = tick() * 1.5
            local offset = Vector3.new(math.cos(t) * radius, height, math.sin(t) * radius)
            local goalPos = thrp.Position + offset
            hrp.CFrame = hrp.CFrame:Lerp(CFrame.new(goalPos, thrp.Position), 0.2)
            if autoAttack then attack() end
        end
    end
end)

-- === Respawn Handler ===
lp.CharacterAdded:Connect(function(char)
    chr = char
    hum = chr:WaitForChild("Humanoid")
    hrp = chr:WaitForChild("HumanoidRootPart")
end)
