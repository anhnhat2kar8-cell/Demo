local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer
local guiParent = lp:WaitForChild("PlayerGui")

-- ƒë·∫£m b·∫£o character h·ª£p l·ªá (c·∫≠p nh·∫≠t khi respawn)
local function getCharacter()
    return lp.Character or lp.CharacterAdded:Wait()
end

local chr = getCharacter()
local hum = chr:FindFirstChild("Humanoid") or chr:WaitForChild("Humanoid")
local hrp = chr:FindFirstChild("HumanoidRootPart") or chr:WaitForChild("HumanoidRootPart")

-- CONFIG / TR·∫†NG TH√ÅI
local farming = false
local radius = 22            -- m·∫∑c ƒë·ªãnh (c√≥ th·ªÉ nh·∫≠p)
local speed = 2              -- m·∫∑c ƒë·ªãnh (c√≥ th·ªÉ nh·∫≠p)
local autoAttack = true
local autoLoot = true
local autoHeal = true
local lastWeapon = nil

local bossModelName = "Boss" -- theo b·∫°n cung c·∫•p
local bossHealth = 15000
local bossMaxHealth = 15000

-- Option: cho ph√©p radius t·ª± nh·∫£y t·ª´ min->max
local cycleRadiusEnabled = true
local cycleMin = 21
local cycleMax = 25
local cycleSpeed = 0.02 -- t·ªëc ƒë·ªô tƒÉng radius khi cycle b·∫≠t

-- CREATE GUI (m·ªù, bo g√≥c, vi·ªÅn, placeholder gi·ªëng ·∫£nh)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZENX_GUI"
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = guiParent

-- Main transparent panel
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 260, 0, 150)
MainFrame.Position = UDim2.new(0.04, 0, 0.28, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
MainFrame.BackgroundTransparency = 0.3 -- m·ªù gi·ªëng ·∫£nh
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true

local mainCorner = Instance.new("UICorner", MainFrame)
mainCorner.CornerRadius = UDim.new(0,10)
local mainStroke = Instance.new("UIStroke", MainFrame)
mainStroke.Thickness = 1
mainStroke.Color = Color3.fromRGB(25,25,25)
mainStroke.Transparency = 0.5

-- Title
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1,0,0,34)
Title.Position = UDim2.new(0,0,0,0)
Title.BackgroundTransparency = 1
Title.Text = "üíÄ ZENX üíÄ"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.TextStrokeTransparency = 0.8

-- Button B·∫≠t/T·∫Øt
local FarmButton = Instance.new("TextButton", MainFrame)
FarmButton.Size = UDim2.new(1,-28,0,36)
FarmButton.Position = UDim2.new(0,14,0,40)
FarmButton.BackgroundColor3 = Color3.fromRGB(45,45,45)
FarmButton.BackgroundTransparency = 0.15
FarmButton.Font = Enum.Font.GothamBold
FarmButton.TextSize = 18
FarmButton.TextColor3 = Color3.fromRGB(255,255,255)
FarmButton.Text = "B·∫≠t Farm Boss"
local btnCorner = Instance.new("UICorner", FarmButton)
btnCorner.CornerRadius = UDim.new(0,8)

-- Rows (hi·ªán 2 √¥ gi·ªëng ·∫£nh: kho·∫£ng c√°ch / t·ªëc ƒë·ªô)
-- Row background (√¥ b√°n trong su·ªët)
local row1 = Instance.new("Frame", MainFrame)
row1.Size = UDim2.new(1,-28,0,28)
row1.Position = UDim2.new(0,14,0,82)
row1.BackgroundColor3 = Color3.fromRGB(30,30,30)
row1.BackgroundTransparency = 0.15
row1.BorderSizePixel = 0
local r1corner = Instance.new("UICorner", row1)
r1corner.CornerRadius = UDim.new(0,6)

local row2 = Instance.new("Frame", MainFrame)
row2.Size = UDim2.new(1,-28,0,28)
row2.Position = UDim2.new(0,14,0,112)
row2.BackgroundColor3 = Color3.fromRGB(30,30,30)
row2.BackgroundTransparency = 0.15
row2.BorderSizePixel = 0
local r2corner = Instance.new("UICorner", row2)
r2corner.CornerRadius = UDim.new(0,6)

-- TextBoxes overlay (cho nh·∫≠p)
local DistanceBox = Instance.new("TextBox", row1)
DistanceBox.Size = UDim2.new(1, -8, 1, 0)
DistanceBox.Position = UDim2.new(0,4,0,0)
DistanceBox.BackgroundTransparency = 1
DistanceBox.Text = tostring(radius)
DistanceBox.PlaceholderText = "Kho·∫£ng c√°ch (VD: 22)"
DistanceBox.Font = Enum.Font.Gotham
DistanceBox.TextSize = 18
DistanceBox.TextColor3 = Color3.fromRGB(255,255,255)
DistanceBox.ClearTextOnFocus = false

local SpeedBox = Instance.new("TextBox", row2)
SpeedBox.Size = UDim2.new(1, -8, 1, 0)
SpeedBox.Position = UDim2.new(0,4,0,0)
SpeedBox.BackgroundTransparency = 1
SpeedBox.Text = tostring(speed)
SpeedBox.PlaceholderText = "T·ªëc ƒë·ªô v√≤ng (VD: 2)"
SpeedBox.Font = Enum.Font.Gotham
SpeedBox.TextSize = 18
SpeedBox.TextColor3 = Color3.fromRGB(255,255,255)
SpeedBox.ClearTextOnFocus = false

-- Small toggle for enabling radius cycle
local CycleToggle = Instance.new("TextButton", MainFrame)
CycleToggle.Size = UDim2.new(0,34,0,22)
CycleToggle.Position = UDim2.new(1,-46,0,8)
CycleToggle.BackgroundColor3 = Color3.fromRGB(60,60,60)
CycleToggle.BackgroundTransparency = 0.15
CycleToggle.Font = Enum.Font.Gotham
CycleToggle.TextSize = 14
CycleToggle.Text = cycleRadiusEnabled and "‚ü≥" or "‚óã"
CycleToggle.TextColor3 = Color3.fromRGB(255,255,255)
local cycleCorner = Instance.new("UICorner", CycleToggle)
cycleCorner.CornerRadius = UDim.new(0,6)

-- Boss HP bar top-right (gi·ªëng ·∫£nh)
local BossFrame = Instance.new("Frame", ScreenGui)
BossFrame.Size = UDim2.new(0, 340, 0, 30)
BossFrame.Position = UDim2.new(1, -360, 0, 18)
BossFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
BossFrame.BackgroundTransparency = 0.15
BossFrame.BorderSizePixel = 0
local bossCorner = Instance.new("UICorner", BossFrame)
bossCorner.CornerRadius = UDim.new(0,6)
local bossStroke = Instance.new("UIStroke", BossFrame)
bossStroke.Thickness = 1
bossStroke.Color = Color3.fromRGB(20,20,20)
bossStroke.Transparency = 0.5

local BossBar = Instance.new("Frame", BossFrame)
BossBar.Size = UDim2.new(1,0,1,0)
BossBar.Position = UDim2.new(0,0,0,0)
BossBar.BackgroundColor3 = Color3.fromRGB(200,0,0)
BossBar.BorderSizePixel = 0
local bossBarCorner = Instance.new("UICorner", BossBar)
bossBarCorner.CornerRadius = UDim.new(0,6)

local BossText = Instance.new("TextLabel", BossFrame)
BossText.Size = UDim2.new(1,0,1,0)
BossText.Position = UDim2.new(0,0,0,0)
BossText.BackgroundTransparency = 1
BossText.Font = Enum.Font.GothamBold
BossText.TextSize = 18
BossText.TextColor3 = Color3.fromRGB(255,255,255)
BossText.Text = "M√°u Boss: " .. bossHealth .. " / " .. bossMaxHealth

-- HELPER: t√¨m target Boss theo t√™n model
local function findBoss()
    for _,v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model") and v.Name == bossModelName and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") then
            if v.Humanoid.Health > 0 then
                return v
            end
        end
    end
    return nil
end

-- C·∫¨P NH·∫¨T thanh boss t·ª´ target
local function updateBossBarFromModel(bossModel)
    if bossModel and bossModel:FindFirstChild("Humanoid") then
        bossHealth = math.max(0, bossModel.Humanoid.Health)
        bossMaxHealth = bossModel.Humanoid.MaxHealth or bossMaxHealth
        if bossMaxHealth > 0 then
            BossBar.Size = UDim2.new(bossHealth / bossMaxHealth, 0, 1, 0)
        else
            BossBar.Size = UDim2.new(0,0,1,0)
        end
        BossText.Text = "M√°u Boss: " .. math.floor(bossHealth) .. " / " .. math.floor(bossMaxHealth)
    else
        -- n·∫øu kh√¥ng t√¨m th·∫•y boss th√¨ gi·ªØ nguy√™n ho·∫∑c hi·ªÉn th·ªã 0
        -- BossBar.Size = UDim2.new(0,0,1,0)
        -- BossText.Text = "M√°u Boss: 0 / " .. bossMaxHealth
    end
end

-- AUTO HEAL: t·ª± b·∫≠t bƒÉng g·∫°c khi HP < ng∆∞·ª°ng
task.spawn(function()
    while true do
        task.wait(0.6)
        if autoHeal then
            -- c·∫≠p nh·∫≠t nh√¢n v·∫≠t n·∫øu respawn
            chr = getCharacter()
            hum = chr:FindFirstChild("Humanoid") or hum
            hrp = chr:FindFirstChild("HumanoidRootPart") or hrp

            if hum and hum.Health and hum.Health < 80 then
                -- l∆∞u weapon hi·ªán c√≥ n·∫øu kh√¥ng ph·∫£i bƒÉng
                local tool = lp.Character and lp.Character:FindFirstChildOfClass("Tool")
                if tool and not tool.Name:lower():find("bƒÉng") then
                    lastWeapon = tool
                end

                -- t√¨m bƒÉng trong backpack
                local bandage = nil
                for _, t in ipairs(lp.Backpack:GetChildren()) do
                    if t:IsA("Tool") and t.Name:lower():find("bƒÉng") then
                        bandage = t
                        break
                    end
                end

                if bandage then
                    bandage.Parent = lp.Character
                    wait(0.15)
                    local healTool = lp.Character:FindFirstChildWhichIsA("Tool")
                    if healTool and healTool.Name:lower():find("bƒÉng") then
                        pcall(function() healTool:Activate() end)
                        wait(1)
                        -- tr·∫£ v≈© kh√≠ c≈© n·∫øu c√≥
                        if lastWeapon and lastWeapon.Parent == lp.Backpack then
                            lastWeapon.Parent = lp.Character
                        end
                    end
                end
            end
        end
    end
end)

-- AUTO LOOT: t·ª± t∆∞∆°ng t√°c ProximityPrompt trong ph·∫°m vi
task.spawn(function()
    while true do
        task.wait(0.5)
        if autoLoot then
            chr = getCharacter()
            hrp = chr:FindFirstChild("HumanoidRootPart") or hrp
            if hrp then
                for _, prompt in pairs(workspace:GetDescendants()) do
                    if prompt and prompt:IsA("ProximityPrompt") and (prompt.Parent:IsA("BasePart") or prompt.Parent:IsA("MeshPart")) then
                        local ok, pos = pcall(function() return prompt.Parent.Position end)
                        if ok and pos then
                            local dist = (hrp.Position - pos).Magnitude
                            if dist <= 15 then
                                pcall(function() fireproximityprompt(prompt) end)
                                wait(0.12)
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- ATTACK: gi·∫£ l·∫≠p b·∫•m tool
local function attack()
    local tool = lp.Character and lp.Character:FindFirstChildOfClass("Tool")
    if tool then
        pcall(function() tool:Activate() end)
    end
end

-- HEARTBEAT: di chuy·ªÉn quanh boss v√† auto attack
RunService.Heartbeat:Connect(function(dt)
    if farming then
        -- c·∫≠p nh·∫≠t ref nh√¢n v·∫≠t
        chr = getCharacter()
        hum = chr:FindFirstChild("Humanoid") or hum
        hrp = chr:FindFirstChild("HumanoidRootPart") or hrp

        local target = findBoss()
        if target and target:FindFirstChild("HumanoidRootPart") then
            -- n·∫øu cycle b·∫≠t, tƒÉng gi·∫£m radius trong kho·∫£ng min->max
            if cycleRadiusEnabled then
                radius = radius + cycleSpeed
                if radius > cycleMax then
                    radius = cycleMin
                end
                DistanceBox.Text = tostring(math.floor(radius))
            end

            -- t√≠nh v·ªã tr√≠ quanh boss
            local thrp = target.HumanoidRootPart
            local angle = tick() * speed
            local offset = Vector3.new(math.cos(angle) * radius, 0, math.sin(angle) * radius)
            local goalPos = thrp.Position + offset

            -- tween m∆∞·ª£t ƒë·∫øn v·ªã tr√≠ (ch·ªâ c·∫≠p nh·∫≠t CFrame h∆∞·ªõng nh√¨n boss)
            local ok, tween = pcall(function()
                return TweenService:Create(hrp, TweenInfo.new(0.12, Enum.EasingStyle.Linear), {CFrame = CFrame.new(goalPos, thrp.Position)})
            end)
            if ok and tween then
                pcall(function() tween:Play() end)
            else
                pcall(function() hrp.CFrame = CFrame.new(goalPos, thrp.Position) end)
            end

            -- disable autorotate ƒë·ªÉ nh√¨n boss
            pcall(function() hum.AutoRotate = false end)

            -- auto attack
            if autoAttack then
                attack()
            end
        end
    end
end)

-- C·∫≠p nh·∫≠t boss bar li√™n t·ª•c t·ª´ model Boss (n·∫øu c√≥)
task.spawn(function()
    while true do
        task.wait(0.12)
        local target = findBoss()
        if target and target:FindFirstChild("Humanoid") then
            updateBossBarFromModel(target)
        end
    end
end)

-- HANDLERS: n√∫t + textboxes + toggle
FarmButton.MouseButton1Click:Connect(function()
    farming = not farming
    FarmButton.Text = farming and "T·∫Øt Farm Boss" or "B·∫≠t Farm Boss"
end)

DistanceBox.FocusLost:Connect(function(enterPressed)
    local n = tonumber(DistanceBox.Text)
    if n and n > 0 then
        radius = n
        -- n·∫øu user thay radius th√¨ t·∫Øt cycle t·ª± ƒë·ªông (tr√°nh override), gi·ªØ t√πy ch·ªçn
        cycleRadiusEnabled = false
        CycleToggle.Text = "‚óã"
    else
        DistanceBox.Text = tostring(radius)
    end
end)

SpeedBox.FocusLost:Connect(function(enterPressed)
    local n = tonumber(SpeedBox.Text)
    if n and n > 0 then
        speed = n
    else
        SpeedBox.Text = tostring(speed)
    end
end)

CycleToggle.MouseButton1Click:Connect(function()
    cycleRadiusEnabled = not cycleRadiusEnabled
    CycleToggle.Text = cycleRadiusEnabled and "‚ü≥" or "‚óã"
    if cycleRadiusEnabled then
        -- kh·ªüi ƒë·ªông t·ª´ min ƒë·ªÉ ƒë√∫ng chu k·ª≥
        radius = cycleMin
        DistanceBox.Text = tostring(radius)
    end
end)

-- Update GUI khi respawn
lp.CharacterAdded:Connect(function(char)
    chr = char
    hum = chr:WaitForChild("Humanoid")
    hrp = chr:WaitForChild("HumanoidRootPart")
end)

-- Khi script b·∫Øt ƒë·∫ßu, fill initial values
DistanceBox.Text = tostring(radius)
SpeedBox.Text = tostring(speed)
CycleToggle.Text = cycleRadiusEnabled and "‚ü≥" or "‚óã"
BossText.Text = "M√°u Boss: " .. bossHealth .. " / " .. bossMaxHealth

-- (Optional) Demo gi·∫£m m√°u boss khi farming ƒë·ªÉ test hi·ªáu ·ª©ng (b·ªè ƒëo·∫°n n√†y tr√™n server th·∫≠t)
-- N·∫øu game th·∫≠t c√≥ boss model "Boss" th√¨ ƒëo·∫°n demo n√†y kh√¥ng c·∫ßn.
task.spawn(function()
    while true do
        task.wait(2)
        local target = findBoss()
        if target and farming then
            -- kh√¥ng t·ª± gi·∫£m n·∫øu game ƒë√£ c√≥ boss HP th·ª±c, n√™n comment/disable khi test game th·∫≠t
            -- updateBossBarFromModel(target) -- n·∫øu boss c√≥ humanoid th√¨ update t·ª± ƒë·ªông
        end
    end
end)

-- END of script
