local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local lp = Players.LocalPlayer
local guiParent = lp:WaitForChild("PlayerGui")

-- === Character refs ===
local function getCharacter()
    return lp.Character or lp.CharacterAdded:Wait()
end
local chr = getCharacter()
local hum = chr:WaitForChild("Humanoid")
local hrp = chr:WaitForChild("HumanoidRootPart")

-- === Config ===
local farming = false
local radius = 22
local speed = 2
local autoAttack = true
local autoLoot = true
local autoHeal = true
local healThreshold = 50 -- % m√°u

-- === GUI ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZENX_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = guiParent

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 280, 0, 200)
MainFrame.Position = UDim2.new(0.04, 0, 0.25, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
MainFrame.BackgroundTransparency = 0.28
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 36)
Title.Position = UDim2.new(0, 0, 0, 6)
Title.BackgroundTransparency = 1
Title.Text = "üíÄ ZENX üíÄ"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Center
Title.Parent = MainFrame

local FarmButton = Instance.new("TextButton")
FarmButton.Size = UDim2.new(1, -24, 0, 40)
FarmButton.Position = UDim2.new(0, 12, 0, 48)
FarmButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
FarmButton.BackgroundTransparency = 0.38
FarmButton.Text = "B·∫≠t Farm Boss"
FarmButton.Font = Enum.Font.GothamBold
FarmButton.TextSize = 18
FarmButton.TextColor3 = Color3.fromRGB(255,255,255)
FarmButton.Parent = MainFrame
Instance.new("UICorner", FarmButton).CornerRadius = UDim.new(0, 8)

FarmButton.MouseButton1Click:Connect(function()
    farming = not farming
    FarmButton.Text = farming and "T·∫Øt Farm Boss" or "B·∫≠t Farm Boss"
end)

-- === Helper: t√¨m boss g·∫ßn nh·∫•t ===
local function findBoss()
    local chosen, shortest = nil, math.huge
    local myPos = hrp.Position
    for _, v in pairs(Workspace:GetDescendants()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") then
            local humv = v:FindFirstChild("Humanoid")
            if humv and humv.Health > 0 then
                local owner = Players:GetPlayerFromCharacter(v)
                if not owner then
                    local d = (v.HumanoidRootPart.Position - myPos).Magnitude
                    if d < shortest then
                        chosen = v
                        shortest = d
                    end
                end
            end
        end
    end
    return chosen
end

-- === Auto Heal ===
task.spawn(function()
    while task.wait(0.6) do
        if autoHeal then
            chr = getCharacter()
            hum = chr:FindFirstChild("Humanoid") or hum
            hrp = chr:FindFirstChild("HumanoidRootPart") or hrp
            if hum and hum.Health > 0 and hum.MaxHealth > 0 then
                local curPct = hum.Health / hum.MaxHealth * 100
                if curPct <= healThreshold then
                    for _, t in ipairs(lp.Backpack:GetChildren()) do
                        if t:IsA("Tool") and (t.Name:lower():find("bƒÉng") or t.Name:lower():find("bandage")) then
                            t.Parent = lp.Character
                            task.wait(0.12)
                            local healTool = lp.Character:FindFirstChildWhichIsA("Tool")
                            if healTool then
                                pcall(function() healTool:Activate() end)
                                task.wait(1)
                            end
                            break
                        end
                    end
                end
            end
        end
    end
end)

-- === Auto Loot ===
task.spawn(function()
    while task.wait(0.8) do -- delay ch·∫≠m h∆°n ƒë·ªÉ tr√°nh spam
        if autoLoot and hrp then
            for _, prompt in pairs(Workspace:GetDescendants()) do
                if prompt:IsA("ProximityPrompt") then
                    local ok, pos = pcall(function() return prompt.Parent.Position end)
                    if ok and (hrp.Position - pos).Magnitude <= 16 then
                        pcall(function() fireproximityprompt(prompt) end)
                    end
                end
            end
        end
    end
end)

-- === Auto Attack ===
local function attack()
    local tool = lp.Character and lp.Character:FindFirstChildOfClass("Tool")
    if tool then
        pcall(function() tool:Activate() end)
    end
end

-- === Di chuy·ªÉn v√≤ng quanh boss (d√πng MoveTo) ===
RunService.Heartbeat:Connect(function()
    if farming and hum and hum.Health > 0 then
        local target = findBoss()
        if target and target:FindFirstChild("HumanoidRootPart") and target.Humanoid.Health > 0 then
            local thrp = target.HumanoidRootPart
            local angle = tick() * (speed or 2)
            local off = Vector3.new(
                math.cos(angle) * (radius + math.random(-2,2)),
                0,
                math.sin(angle) * (radius + math.random(-2,2))
            )
            local goalPos = thrp.Position + off

            -- d√πng MoveTo ƒë·ªÉ an to√†n h∆°n
            hum:MoveTo(goalPos)
            hrp.CFrame = CFrame.new(hrp.Position, thrp.Position)

            if autoAttack then attack() end
        end
    end
end)

-- === Respawn Handler ===
lp.CharacterAdded:Connect(function(char)
    chr = char
    hum = chr:WaitForChild("Humanoid")
    hrp = chr:WaitForChild("HumanoidRootPart")
end)
