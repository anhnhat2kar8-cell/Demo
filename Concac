local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

-- ====== BIẾN BẬT/TẮT ======
local autoFarm = false
local autoHeal = false
local autoLoot = false

-- ====== TẠO GUI THANH MÁU BOSS ======
local billboardGui = Instance.new("BillboardGui")
billboardGui.Name = "BossHealthBar"
billboardGui.Size = UDim2.new(6, 0, 1.2, 0)
billboardGui.AlwaysOnTop = true
billboardGui.ExtentsOffset = Vector3.new(0, 4.5, 0)
billboardGui.Adornee = nil
billboardGui.Enabled = false
billboardGui.Parent = Workspace

-- Label BOSS
local bossLabel = Instance.new("TextLabel")
bossLabel.Size = UDim2.new(1, 0, 0.45, 0)
bossLabel.Position = UDim2.new(0, 0, 0, -20)
bossLabel.BackgroundTransparency = 1
bossLabel.Text = "BOSS"
bossLabel.TextColor3 = Color3.fromRGB(220, 30, 30)
bossLabel.Font = Enum.Font.GothamBold
bossLabel.TextScaled = true
bossLabel.Parent = billboardGui
bossLabel.TextStrokeTransparency = 0.6

-- Nền thanh máu
local bgFrame = Instance.new("Frame")
bgFrame.Size = UDim2.new(0.9, 0, 0.35, 0)
bgFrame.Position = UDim2.new(0.05, 0, 0.5, 0)
bgFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
bgFrame.BackgroundTransparency = 0.15
bgFrame.BorderSizePixel = 0
bgFrame.Parent = billboardGui
Instance.new("UICorner", bgFrame).CornerRadius = UDim.new(0, 8)

-- Thanh máu
local healthBar = Instance.new("Frame")
healthBar.Size = UDim2.new(1, 0, 1, 0)
healthBar.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
healthBar.BorderSizePixel = 0
healthBar.Parent = bgFrame
Instance.new("UICorner", healthBar).CornerRadius = UDim.new(0, 8)

-- HP / Max
local hpText = Instance.new("TextLabel")
hpText.Size = UDim2.new(1, 0, 0.4, 0)
hpText.Position = UDim2.new(0, 0, 1.1, 0)
hpText.BackgroundTransparency = 1
hpText.TextColor3 = Color3.new(1, 1, 1)
hpText.Font = Enum.Font.GothamBold
hpText.TextScaled = true
hpText.TextStrokeTransparency = 0.7
hpText.Parent = billboardGui
hpText.Text = "0 / 0"

-- % máu
local pctText = Instance.new("TextLabel")
pctText.Size = UDim2.new(0.25, 0, 0.55, 0)
pctText.Position = UDim2.new(0.735, 0, 1.05, 0)
pctText.BackgroundTransparency = 1
pctText.TextColor3 = Color3.new(1, 1, 1)
pctText.Font = Enum.Font.GothamBold
pctText.TextScaled = true
pctText.TextStrokeTransparency = 0.7
pctText.Parent = billboardGui

-- ====== HÀM TÌM BOSS GẦN NHẤT ======
local function getNearestBoss()
    local nearest, dist = nil, math.huge
    for _, mob in ipairs(Workspace:GetDescendants()) do
        if mob:FindFirstChild("Humanoid") and mob:FindFirstChild("HumanoidRootPart") and mob.Name:lower():find("boss") then
            local d = (player.Character.HumanoidRootPart.Position - mob.HumanoidRootPart.Position).Magnitude
            if d < dist then
                dist = d
                nearest = mob
            end
        end
    end
    return nearest
end

-- ====== CẬP NHẬT THANH MÁU BOSS ======
RunService.RenderStepped:Connect(function()
    local boss = getNearestBoss()
    if boss and boss:FindFirstChild("Humanoid") then
        local humanoid = boss.Humanoid
        local cur = humanoid.Health
        local max = humanoid.MaxHealth
        billboardGui.Adornee = boss:FindFirstChild("Head") or boss:FindFirstChild("HumanoidRootPart")
        healthBar.Size = UDim2.new(cur / max, 0, 1, 0)
        healthBar.BackgroundColor3 = Color3.fromRGB(255 - (cur / max) * 255, (cur / max) * 255, 0)
        hpText.Text = string.format("%d / %d", math.floor(cur), math.floor(max))
        pctText.Text = string.format("%d%%", math.floor((cur / max) * 100))
        billboardGui.Enabled = true
    else
        billboardGui.Enabled = false
    end
end)

-- ====== AUTO FARM BOSS ======
spawn(function()
    while task.wait(0.2) do
        if autoFarm and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local boss = getNearestBoss()
            if boss and boss:FindFirstChild("HumanoidRootPart") then
                player.Character:MoveTo(boss.HumanoidRootPart.Position + Vector3.new(0, 3, 0))
            end
        end
    end
end)

-- ====== AUTO HEAL ======
spawn(function()
    while task.wait(1) do
        if autoHeal and player.Character and player.Character:FindFirstChild("Humanoid") then
            if player.Character.Humanoid.Health < (player.Character.Humanoid.MaxHealth * 0.5) then
                local bandage = player.Backpack:FindFirstChild("Bandage") or player.Character:FindFirstChild("Bandage")
                if bandage and bandage:FindFirstChild("RemoteEvent") then
                    bandage.RemoteEvent:FireServer()
                end
            end
        end
    end
end)

-- ====== AUTO LOOT ITEM ======
spawn(function()
    while task.wait(0.3) do
        if autoLoot then
            for _, item in ipairs(Workspace:GetChildren()) do
                if item:IsA("Tool") or item:IsA("Model") and item:FindFirstChild("Handle") then
                    firetouchinterest(player.Character.HumanoidRootPart, item.Handle, 0)
                    task.wait()
                    firetouchinterest(player.Character.HumanoidRootPart, item.Handle, 1)
                end
            end
        end
    end
end)

-- ====== MENU GUI ======
local ScreenGui = Instance.new("ScreenGui", player.PlayerGui)
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 200, 0, 150)
Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Frame.Active = true
Frame.Draggable = true

local UIListLayout = Instance.new("UIListLayout", Frame)
UIListLayout.Padding = UDim.new(0, 5)

-- Nút tạo toggle
local function createToggle(name, callback)
    local btn = Instance.new("TextButton", Frame)
    btn.Size = UDim2.new(1, 0, 0, 30)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Text = name .. ": OFF"
    btn.MouseButton1Click:Connect(function()
        callback()
        if btn.Text:find("OFF") then
            btn.Text = name .. ": ON"
            btn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
        else
            btn.Text = name .. ": OFF"
            btn.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
        end
    end)
end

-- Tạo nút chức năng
createToggle("Auto Farm", function() autoFarm = not autoFarm end)
createToggle("Auto Heal", function() autoHeal = not autoHeal end)
createToggle("Auto Loot", function() autoLoot = not autoLoot end)
