local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local lp = Players.LocalPlayer
local chr = lp.Character or lp.CharacterAdded:Wait()
local hrp = chr:WaitForChild("HumanoidRootPart")

local flying = false
local waypoints = {}
local currentIndex = 1
local tween

-- tìm boss gần nhất
local function getNearestBoss()
    local nearest, dist = nil, math.huge
    for _, v in ipairs(Workspace:GetChildren()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v.Name:lower():find("boss") then
            local bossHRP = v:FindFirstChild("HumanoidRootPart")
            if bossHRP then
                local d = (bossHRP.Position - hrp.Position).Magnitude
                if d < dist then
                    dist = d
                    nearest = bossHRP
                end
            end
        end
    end
    return nearest
end

-- tạo waypoint quanh boss
local function createWaypoints(bossHRP, radius)
    local wp = {}
    for i = 1, 6 do
        local angle = math.rad((i / 6) * 360)
        local pos = bossHRP.Position + Vector3.new(math.cos(angle) * radius, 15, math.sin(angle) * radius)
        table.insert(wp, pos)
    end
    return wp
end

-- bay tới waypoint
local function flyTo(pos)
    if tween then tween:Cancel() end
    local info = TweenInfo.new(2, Enum.EasingStyle.Linear)
    tween = TweenService:Create(hrp, info, {CFrame = CFrame.new(pos)})
    tween:Play()
    tween.Completed:Wait()
end

-- loop bay quanh boss
local function startFlying()
    flying = true
    local bossHRP = getNearestBoss()
    if not bossHRP then return end
    waypoints = createWaypoints(bossHRP, 25)
    currentIndex = 1
    while flying and bossHRP and bossHRP.Parent do
        flyTo(waypoints[currentIndex])
        currentIndex = currentIndex % #waypoints + 1
    end
end

local function stopFlying()
    flying = false
    if tween then tween:Cancel() end
end

-- GUI toggle
local gui = Instance.new("ScreenGui", lp:WaitForChild("PlayerGui"))
local button = Instance.new("TextButton", gui)
button.Size = UDim2.new(0, 120, 0, 40)
button.Position = UDim2.new(0.05, 0, 0.1, 0)
button.Text = "Bay Waypoint: OFF"
button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
button.TextColor3 = Color3.fromRGB(255, 255, 255)

button.MouseButton1Click:Connect(function()
    if flying then
        stopFlying()
        button.Text = "Bay Waypoint: OFF"
    else
        task.spawn(startFlying)
        button.Text = "Bay Waypoint: ON"
    end
end)
