--// Infinite Stamina + Auto Attack + Show Player Health
local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local player = Players.LocalPlayer

-- Cài đặt
local infiniteStamina = false
local autoAttack = false
local showHealth = false
local attackDelay = 0.15 -- tốc độ đánh (giây)

-- GUI
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local Frame = Instance.new("Frame", ScreenGui)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.Position = UDim2.new(0.05, 0, 0.3, 0)
Frame.Size = UDim2.new(0, 240, 0, 190)
Frame.Active, Frame.Draggable = true, true
Instance.new("UICorner", Frame)

local Title = Instance.new("TextLabel", Frame)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "Farm Menu"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 18

-- Toggle Stamina
local ToggleStamina = Instance.new("TextButton", Frame)
ToggleStamina.Position = UDim2.new(0.1, 0, 0.25, 0)
ToggleStamina.Size = UDim2.new(0.8, 0, 0, 30)
ToggleStamina.Text = "Infinite Stamina: OFF"
ToggleStamina.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
ToggleStamina.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", ToggleStamina)

-- Toggle Auto Attack
local ToggleAttack = Instance.new("TextButton", Frame)
ToggleAttack.Position = UDim2.new(0.1, 0, 0.45, 0)
ToggleAttack.Size = UDim2.new(0.8, 0, 0, 30)
ToggleAttack.Text = "Auto Attack: OFF"
ToggleAttack.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
ToggleAttack.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", ToggleAttack)

-- Toggle Show Health
local ToggleHealth = Instance.new("TextButton", Frame)
ToggleHealth.Position = UDim2.new(0.1, 0, 0.65, 0)
ToggleHealth.Size = UDim2.new(0.8, 0, 0, 30)
ToggleHealth.Text = "Show Health: OFF"
ToggleHealth.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
ToggleHealth.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", ToggleHealth)

-- Hàm giữ stamina luôn max
local function keepStamina()
    while infiniteStamina do
        local stats = player:FindFirstChild("Stats") or player:FindFirstChild("leaderstats")
        if stats then
            local stamina = stats:FindFirstChild("Stamina") or stats:FindFirstChild("Energy")
            if stamina and stamina.Value < (stamina.MaxValue or stamina.Value) then
                stamina.Value = stamina.MaxValue or 100
            end
        end
        task.wait(0.1)
    end
end

-- Hàm auto attack khi cầm vũ khí
local function autoAttackLoop()
    while autoAttack do
        task.wait(attackDelay)
        if player.Character and player.Character:FindFirstChildOfClass("Tool") then
            VirtualUser:Button1Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
            VirtualUser:Button1Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        end
    end
end

-- Hàm hiện máu trên đầu người chơi
local function updateHealthDisplay(plr)
    if not plr.Character then return end
    local head = plr.Character:FindFirstChild("Head")
    if not head then return end

    local billboard = head:FindFirstChild("HealthDisplay")
    if not billboard then
        billboard = Instance.new("BillboardGui")
        billboard.Name = "HealthDisplay"
        billboard.Adornee = head
        billboard.Size = UDim2.new(0,100,0,20)
        billboard.StudsOffset = Vector3.new(0,2,0)
        billboard.AlwaysOnTop = true
        billboard.Parent = head

        local text = Instance.new("TextLabel", billboard)
        text.Size = UDim2.new(1,0,1,0)
        text.BackgroundTransparency = 1
        text.TextColor3 = Color3.fromRGB(0,255,0)
        text.Font = Enum.Font.SourceSansBold
        text.TextScaled = true
    end

    local humanoid = plr.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        local text = billboard:FindFirstChildOfClass("TextLabel")
        if text then
            text.Text = math.floor(humanoid.Health) .. " / " .. math.floor(humanoid.MaxHealth)
        end
    end
end

local function healthLoop()
    while showHealth do
        for _,plr in pairs(Players:GetPlayers()) do
            if plr ~= player then
                updateHealthDisplay(plr)
            end
        end
        task.wait(0.2)
    end
end

-- Toggle stamina
ToggleStamina.MouseButton1Click:Connect(function()
    infiniteStamina = not infiniteStamina
    if infiniteStamina then
        ToggleStamina.Text = "Infinite Stamina: ON"
        ToggleStamina.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
        task.spawn(keepStamina)
    else
        ToggleStamina.Text = "Infinite Stamina: OFF"
        ToggleStamina.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
    end
end)

-- Toggle auto attack
ToggleAttack.MouseButton1Click:Connect(function()
    autoAttack = not autoAttack
    if autoAttack then
        ToggleAttack.Text = "Auto Attack: ON"
        ToggleAttack.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
        task.spawn(autoAttackLoop)
    else
        ToggleAttack.Text = "Auto Attack: OFF"
        ToggleAttack.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
    end
end)

-- Toggle show health
ToggleHealth.MouseButton1Click:Connect(function()
    showHealth = not showHealth
    if showHealth then
        ToggleHealth.Text = "Show Health: ON"
        ToggleHealth.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
        task.spawn(healthLoop)
    else
        ToggleHealth.Text = "Show Health: OFF"
        ToggleHealth.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
        -- ẩn khi tắt
        for _,plr in pairs(Players:GetPlayers()) do
            if plr.Character and plr.Character:FindFirstChild("Head") then
                local gui = plr.Character.Head:FindFirstChild("HealthDisplay")
                if gui then gui:Destroy() end
            end
        end
    end
end)
